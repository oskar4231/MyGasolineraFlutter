# Backend MyGasolinera

Este es el backend de la aplicaci√≥n MyGasolinera, desarrollado en Java con servidor HTTP y conexi√≥n a MariaDB.

## ‚öôÔ∏è Configuraci√≥n del Proyecto (IMPORTANTE)

### Para VS Code

1. **Instala la extensi√≥n de Java**: [Extension Pack for Java](https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack)

2. **Abre el proyecto**: El archivo `.vscode/settings.json` ya est√° configurado con las librer√≠as necesarias.

3. **Recarga la ventana**: Presiona `Ctrl+Shift+P` y ejecuta `Java: Clean Java Language Server Workspace` si sigues viendo errores.

### Para Eclipse/IntelliJ

Los archivos `.classpath` y `.project` ya est√°n configurados. Simplemente importa el proyecto como "Existing Project".

### Librer√≠as incluidas

Las siguientes librer√≠as ya est√°n en la carpeta `basededatosjava/`:
- ‚úÖ `mariadb-java-client-3.5.6.jar` - Driver de MariaDB
- ‚úÖ `json-20250517.jar` - Librer√≠a JSON de org.json

**No necesitas descargar nada adicional.** Todo est√° incluido en el repositorio.

### ‚ö†Ô∏è ¬øProblemas con las importaciones?

Si ves el error "The import org.json cannot be resolved", consulta [TROUBLESHOOTING.md](TROUBLESHOOTING.md) para soluciones detalladas.

## üìÅ Estructura

```
BackendBBDD/
‚îî‚îÄ‚îÄ basededatosjava/
    ‚îú‚îÄ‚îÄ BBDD.java                           # Servidor HTTP principal
    ‚îú‚îÄ‚îÄ BBDD.class                          # Clase compilada
    ‚îú‚îÄ‚îÄ mariadb-java-client-3.5.6.jar      # Driver MariaDB
    ‚îî‚îÄ‚îÄ json-20250517.jar                   # Librer√≠a JSON
```

## üöÄ Inicio R√°pido

### Primera vez (Configuraci√≥n inicial)

1. **Clona el repositorio**
   ```bash
   git clone <URL_DEL_REPO>
   cd BackendBBDD
   ```

2. **(Opcional) Verifica tu entorno** (Windows)
   ```bash
   check-setup.bat
   ```

   Esto verificar√° que tengas Java instalado y todas las librer√≠as necesarias.

3. **Ejecuta el script de configuraci√≥n**

   **Windows:**
   ```bash
   setup.bat
   ```

   **Linux/Mac:**
   ```bash
   chmod +x setup.sh
   ./setup.sh
   ```

   Esto compilar√° el proyecto autom√°ticamente.

4. **Inicia el servidor**

   **Windows:**
   ```bash
   start-server.bat
   ```

   **Linux/Mac:**
   ```bash
   cd basededatosjava
   java -cp ".:mariadb-java-client-3.5.6.jar:json-20250517.jar" BBDD
   ```

### Ejecuci√≥n normal

Simplemente ejecuta:
```bash
start-server.bat
```

El servidor se iniciar√° en: `http://localhost:5001`

### Compilaci√≥n manual (opcional)

Si prefieres compilar manualmente:

```bash
cd basededatosjava
javac -cp ".;mariadb-java-client-3.5.6.jar;json-20250517.jar" BBDD.java
java -cp ".;mariadb-java-client-3.5.6.jar;json-20250517.jar" BBDD
```

## üì° Endpoints disponibles

### POST /register
Registra un nuevo usuario en la base de datos.

**Request:**
```json
{
  "email": "usuario@example.com",
  "password": "contrase√±a123"
}
```

**Response (200 OK):**
```json
{
  "status": "success",
  "message": "Usuario creado correctamente"
}
```

**Response (409 Conflict):**
```json
{
  "status": "error",
  "message": "El email ya est√° registrado"
}
```

### POST /login
Inicia sesi√≥n con email y contrase√±a.

**Request:**
```json
{
  "email": "usuario@example.com",
  "password": "contrase√±a123"
}
```

**Response (200 OK):**
```json
{
  "status": "success",
  "message": "Login exitoso",
  "email": "usuario@example.com"
}
```

**Response (401 Unauthorized):**
```json
{
  "status": "error",
  "message": "Email o contrase√±a incorrectos"
}
```

## üóÑÔ∏è Configuraci√≥n de Base de Datos

### Requisitos
- MariaDB instalado y corriendo en `localhost:3306`
- Base de datos: `mygasolinera`
- Usuario: `root`
- Contrase√±a: (vac√≠a)

### Estructura de la tabla `usuarios`

```sql
CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## üîß Configuraci√≥n

Para cambiar la configuraci√≥n de la base de datos, edita las siguientes l√≠neas en `BBDD.java`:

```java
miConexion = DriverManager.getConnection(
    "jdbc:mariadb://127.0.0.1:3306/mygasolinera",
    "root",  // Usuario
    ""       // Contrase√±a
);
```

## üåê CORS

El servidor tiene CORS habilitado para permitir peticiones desde cualquier origen (`Access-Control-Allow-Origin: *`).

## üìù Notas

- Las contrase√±as se guardan en **texto plano** por ahora (‚ö†Ô∏è NO recomendado para producci√≥n)
- El servidor escucha en todas las interfaces (`0.0.0.0:5001`)
- Los logs se muestran en la consola

## üîó Conexi√≥n con Flutter

El frontend Flutter se conecta a este backend en:
- **Registro**: `http://localhost:5001/register`
- **Login**: `http://localhost:5001/login`

Aseg√∫rate de que el servidor est√© corriendo antes de usar la aplicaci√≥n Flutter.

